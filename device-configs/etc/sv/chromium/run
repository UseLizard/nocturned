#!/bin/sh

exec 2>&1
sv check weston > /dev/null || exit 1
sv check nocturne-ui > /dev/null || exit 1
sv check nocturned > /dev/null || exit 1

# Wait for nocturned WebSocket to be ready
for i in 1 2 3 4 5 6 7 8 9 10; do
    if curl -s http://localhost:5000/bluetooth/status > /dev/null 2>&1; then
        break
    fi
    sleep 2
done

export XDG_RUNTIME_DIR="/run/wayland/"
export XDG_CACHE_HOME="/var/cache"
export BREAKPAD_DUMP_LOCATION="/var/cache/chrome_storage/Crash Reports"

exec /usr/bin/chromium-browser/chrome --no-sandbox --in-process-gpu --remote-debugging-port=2222 --user-data-dir=/var/cache/chrome_storage --kiosk --disable-pinch --allow-file-access-from-files --ignore-certificate-errors --app=http://localhost:80 > /dev/null 2>&1
